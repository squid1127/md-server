<!-- md-server - Markdown Document -->
{% extends 'base.html' %}

<!-- Markdown Content -->
{% block content %}
<section class="content markdown-body">{{ markdown_content | safe }}</section>
{% endblock %}

<!-- Header Extra Content -->
{% block header_right %} {% if md_id %}
<button
  id="copy-markdown-btn"
  class="copy-btn header-btn"
  title="Copy markdown source"
>
  <span class="material-symbols-outlined">content_copy</span>
</button>
<button
  class="header-btn"
  onclick="window.open('/raw/{{ md_id }}', '_blank')"
  title="Open raw markdown"
>
  <span class="material-symbols-outlined">code</span>
</button>
{% endif %} {% if source %}
<button
  class="header-btn"
  onclick="window.open('{{ source }}', '_blank')"
  title="Source code"
>
  <span class="material-symbols-outlined">open_in_new</span>
</button>
{% endif %} {% endblock %} {% block scripts %} {% if md_id %}
<script>
  // Copy markdown to clipboard
  document.addEventListener("DOMContentLoaded", function () {
    const copyBtn = document.getElementById("copy-markdown-btn");

    copyBtn.addEventListener("click", async function () {
      try {
        // Fetch raw markdown content
        const response = await fetch("/raw/{{ md_id }}");
        if (!response.ok) {
          throw new Error("Failed to fetch markdown content");
        }

        const markdown = await response.text();

        // Copy to clipboard
        await navigator.clipboard.writeText(markdown);

        // Visual feedback
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML =
          '<span class="material-symbols-outlined">check</span>';
        copyBtn.classList.add("copied");

        setTimeout(() => {
          copyBtn.innerHTML = originalText;
          copyBtn.classList.remove("copied");
        }, 2000);
      } catch (error) {
        console.error("Failed to copy markdown:", error);

        // Error feedback
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML =
          '<span class="material-symbols-outlined">error</span>';
        copyBtn.classList.add("error");

        setTimeout(() => {
          copyBtn.innerHTML = originalText;
          copyBtn.classList.remove("error");
        }, 2000);
      }
    });
  });
</script>
{% endif %}
<script>
  // Header scroll effect
  window.addEventListener("scroll", () => {
    const header = document.querySelector(".header");
    if (window.scrollY < 32) {
      header.classList.remove("scrolled");
    } else {
      header.classList.add("scrolled");
    }
  });
</script>
{% endblock %}
